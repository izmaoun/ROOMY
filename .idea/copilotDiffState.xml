<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/roomy/Dao/HotelierDAO.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/roomy/Dao/HotelierDAO.java" />
              <option name="originalContent" value="package com.roomy.Dao;&#10;&#10;import com.roomy.entities.Hotelier;&#10;import java.sql.*;&#10;&#10;public class HotelierDAO {&#10;&#10;    // Trouver un hotelier par email (pour le login)&#10;    public Hotelier findByEmail(String email) {&#10;        String sql = &quot;SELECT * FROM hoteliers WHERE email_gerant = ?&quot;;&#10;        try (Connection c = DBConnection.getConnection();&#10;             PreparedStatement ps = c.prepareStatement(sql)) {&#10;&#10;            ps.setString(1, email);&#10;            ResultSet rs = ps.executeQuery();&#10;&#10;            if (rs.next()) {&#10;                Hotelier hotelier = new Hotelier();&#10;                hotelier.setIdHotelier(rs.getInt(&quot;id_hotelier&quot;));&#10;                hotelier.setNomEtablissement(rs.getString(&quot;nom_etablissement&quot;));&#10;                hotelier.setNomGerant(rs.getString(&quot;nom_gerant&quot;));&#10;                hotelier.setPrenomGerant(rs.getString(&quot;prenom_gerant&quot;));&#10;                hotelier.setVille(rs.getString(&quot;ville&quot;));&#10;                hotelier.setEmailGerant(rs.getString(&quot;email_gerant&quot;));&#10;                hotelier.setTelephone(rs.getString(&quot;telephone&quot;));&#10;                hotelier.setPassword(rs.getString(&quot;password&quot;));&#10;                hotelier.setIce(rs.getString(&quot;ice&quot;));&#10;                hotelier.setDateInscription(rs.getTimestamp(&quot;date_inscription&quot;).toLocalDateTime());&#10;                hotelier.setStatutVerification(rs.getString(&quot;statut_verification&quot;));&#10;                return hotelier;&#10;            }&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Erreur lors de la recherche par email: &quot; + e.getMessage());&#10;            e.printStackTrace();&#10;        }&#10;        return null;&#10;    }&#10;&#10;    // Trouver un hotelier par ICE&#10;    public Hotelier findByIce(String ice) {&#10;        String sql = &quot;SELECT * FROM hoteliers WHERE ice = ?&quot;;&#10;        try (Connection c = DBConnection.getConnection();&#10;             PreparedStatement ps = c.prepareStatement(sql)) {&#10;&#10;            ps.setString(1, ice);&#10;            ResultSet rs = ps.executeQuery();&#10;&#10;            if (rs.next()) {&#10;                Hotelier hotelier = new Hotelier();&#10;                hotelier.setIdHotelier(rs.getInt(&quot;id_hotelier&quot;));&#10;                hotelier.setNomEtablissement(rs.getString(&quot;nom_etablissement&quot;));&#10;                hotelier.setNomGerant(rs.getString(&quot;nom_gerant&quot;));&#10;                hotelier.setPrenomGerant(rs.getString(&quot;prenom_gerant&quot;));&#10;                hotelier.setVille(rs.getString(&quot;ville&quot;));&#10;                hotelier.setEmailGerant(rs.getString(&quot;email_gerant&quot;));&#10;                hotelier.setTelephone(rs.getString(&quot;telephone&quot;));&#10;                hotelier.setPassword(rs.getString(&quot;password&quot;));&#10;                hotelier.setIce(rs.getString(&quot;ice&quot;));&#10;                hotelier.setDateInscription(rs.getTimestamp(&quot;date_inscription&quot;).toLocalDateTime());&#10;                hotelier.setStatutVerification(rs.getString(&quot;statut_verification&quot;));&#10;                return hotelier;&#10;            }&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Erreur lors de la recherche par ICE: &quot; + e.getMessage());&#10;            e.printStackTrace();&#10;        }&#10;        return null;&#10;    }&#10;&#10;    // Inscription hotelier&#10;    public boolean signup(Hotelier hotelier) {&#10;        String sql = &quot;INSERT INTO hoteliers (nom_etablissement, nom_gerant, prenom_gerant, ville, email_gerant, telephone, password, ice) VALUES (?, ?, ?, ?, ?, ?, ?, ?)&quot;;&#10;        try (Connection c = DBConnection.getConnection();&#10;             PreparedStatement ps = c.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {&#10;&#10;            ps.setString(1, hotelier.getNomEtablissement());&#10;            ps.setString(2, hotelier.getNomGerant());&#10;            ps.setString(3, hotelier.getPrenomGerant());&#10;            ps.setString(4, hotelier.getVille());&#10;            ps.setString(5, hotelier.getEmailGerant());&#10;            ps.setString(6, hotelier.getTelephone());&#10;            ps.setString(7, hotelier.getPassword()); // déjà hashé avec BCrypt&#10;            ps.setString(8, hotelier.getIce());&#10;&#10;            int affectedRows = ps.executeUpdate();&#10;&#10;            if (affectedRows &gt; 0) {&#10;                // Récupérer l'ID généré&#10;                try (ResultSet generatedKeys = ps.getGeneratedKeys()) {&#10;                    if (generatedKeys.next()) {&#10;                        hotelier.setIdHotelier(generatedKeys.getInt(1));&#10;                    }&#10;                }&#10;                System.out.println(&quot;Inscription hotelier réussie - ID: &quot; + hotelier.getIdHotelier());&#10;                return true;&#10;            }&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Erreur inscription hotelier : &quot; + e.getMessage());&#10;            e.printStackTrace();&#10;        }&#10;        return false;&#10;    }&#10;&#10;    // Mettre à jour le statut de vérification&#10;    public boolean updateStatutVerification(int idHotelier, String statut) {&#10;        String sql = &quot;UPDATE hoteliers SET statut_verification = ? WHERE id_hotelier = ?&quot;;&#10;        try (Connection c = DBConnection.getConnection();&#10;             PreparedStatement ps = c.prepareStatement(sql)) {&#10;&#10;            ps.setString(1, statut);&#10;            ps.setInt(2, idHotelier);&#10;&#10;            int affectedRows = ps.executeUpdate();&#10;            if (affectedRows &gt; 0) {&#10;                System.out.println(&quot;Statut de vérification mis à jour pour l'hotelier ID: &quot; + idHotelier);&#10;                return true;&#10;            }&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Erreur mise à jour statut vérification : &quot; + e.getMessage());&#10;            e.printStackTrace();&#10;        }&#10;        return false;&#10;    }&#10;&#10;    // Vérifier si un email existe déjà&#10;    public boolean existsByEmail(String email) {&#10;        return findByEmail(email) != null;&#10;    }&#10;&#10;    // Vérifier si un ICE existe déjà&#10;    public boolean existsByIce(String ice) {&#10;        return findByIce(ice) != null;&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.roomy.Dao;&#13;&#10;&#13;&#10;import com.roomy.entities.Hotelier;&#13;&#10;import java.sql.*;&#13;&#10;&#13;&#10;public class HotelierDAO {&#13;&#10;&#13;&#10;    // Trouver un hotelier par email (pour le login)&#13;&#10;    public Hotelier findByEmail(String email) {&#13;&#10;        String sql = &quot;SELECT * FROM hoteliers WHERE email_gerant = ?&quot;;&#13;&#10;        try (Connection c = DBConnection.getConnection();&#13;&#10;             PreparedStatement ps = c.prepareStatement(sql)) {&#13;&#10;&#13;&#10;            ps.setString(1, email);&#13;&#10;            ResultSet rs = ps.executeQuery();&#13;&#10;&#13;&#10;            if (rs.next()) {&#13;&#10;                Hotelier hotelier = new Hotelier();&#13;&#10;                hotelier.setIdHotelier(rs.getInt(&quot;id_hotelier&quot;));&#13;&#10;                hotelier.setNomEtablissement(rs.getString(&quot;nom_etablissement&quot;));&#13;&#10;                hotelier.setNomGerant(rs.getString(&quot;nom_gerant&quot;));&#13;&#10;                hotelier.setPrenomGerant(rs.getString(&quot;prenom_gerant&quot;));&#13;&#10;                hotelier.setVille(rs.getString(&quot;ville&quot;));&#13;&#10;                hotelier.setEmailGerant(rs.getString(&quot;email_gerant&quot;));&#13;&#10;                hotelier.setTelephone(rs.getString(&quot;telephone&quot;));&#13;&#10;                hotelier.setPassword(rs.getString(&quot;password&quot;));&#13;&#10;                hotelier.setIce(rs.getString(&quot;ice&quot;));&#13;&#10;                hotelier.setDateInscription(rs.getTimestamp(&quot;date_inscription&quot;).toLocalDateTime());&#13;&#10;                hotelier.setStatutVerification(rs.getString(&quot;statut_verification&quot;));&#13;&#10;                return hotelier;&#13;&#10;            }&#13;&#10;        } catch (SQLException e) {&#13;&#10;            System.err.println(&quot;Erreur lors de la recherche par email: &quot; + e.getMessage());&#13;&#10;            e.printStackTrace();&#13;&#10;        }&#13;&#10;        return null;&#13;&#10;    }&#13;&#10;&#13;&#10;    // Trouver un hotelier par ICE&#13;&#10;    public Hotelier findByIce(String ice) {&#13;&#10;        String sql = &quot;SELECT * FROM hoteliers WHERE ice = ?&quot;;&#13;&#10;        try (Connection c = DBConnection.getConnection();&#13;&#10;             PreparedStatement ps = c.prepareStatement(sql)) {&#13;&#10;&#13;&#10;            ps.setString(1, ice);&#13;&#10;            ResultSet rs = ps.executeQuery();&#13;&#10;&#13;&#10;            if (rs.next()) {&#13;&#10;                Hotelier hotelier = new Hotelier();&#13;&#10;                hotelier.setIdHotelier(rs.getInt(&quot;id_hotelier&quot;));&#13;&#10;                hotelier.setNomEtablissement(rs.getString(&quot;nom_etablissement&quot;));&#13;&#10;                hotelier.setNomGerant(rs.getString(&quot;nom_gerant&quot;));&#13;&#10;                hotelier.setPrenomGerant(rs.getString(&quot;prenom_gerant&quot;));&#13;&#10;                hotelier.setVille(rs.getString(&quot;ville&quot;));&#13;&#10;                hotelier.setEmailGerant(rs.getString(&quot;email_gerant&quot;));&#13;&#10;                hotelier.setTelephone(rs.getString(&quot;telephone&quot;));&#13;&#10;                hotelier.setPassword(rs.getString(&quot;password&quot;));&#13;&#10;                hotelier.setIce(rs.getString(&quot;ice&quot;));&#13;&#10;                hotelier.setDateInscription(rs.getTimestamp(&quot;date_inscription&quot;).toLocalDateTime());&#13;&#10;                hotelier.setStatutVerification(rs.getString(&quot;statut_verification&quot;));&#13;&#10;                return hotelier;&#13;&#10;            }&#13;&#10;        } catch (SQLException e) {&#13;&#10;            System.err.println(&quot;Erreur lors de la recherche par ICE: &quot; + e.getMessage());&#13;&#10;            e.printStackTrace();&#13;&#10;        }&#13;&#10;        return null;&#13;&#10;    }&#13;&#10;&#13;&#10;    // Inscription hotelier&#13;&#10;    public boolean signup(Hotelier hotelier) {&#13;&#10;        String sql = &quot;INSERT INTO hoteliers (nom_etablissement, nom_gerant, prenom_gerant, ville, email_gerant, telephone, password, ice) VALUES (?, ?, ?, ?, ?, ?, ?, ?)&quot;;&#13;&#10;        try (Connection c = DBConnection.getConnection();&#13;&#10;             PreparedStatement ps = c.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {&#13;&#10;&#13;&#10;            ps.setString(1, hotelier.getNomEtablissement());&#13;&#10;            ps.setString(2, hotelier.getNomGerant());&#13;&#10;            ps.setString(3, hotelier.getPrenomGerant());&#13;&#10;            ps.setString(4, hotelier.getVille());&#13;&#10;            ps.setString(5, hotelier.getEmailGerant());&#13;&#10;            ps.setString(6, hotelier.getTelephone());&#13;&#10;            ps.setString(7, hotelier.getPassword()); // déjà hashé avec BCrypt&#13;&#10;            ps.setString(8, hotelier.getIce());&#13;&#10;&#13;&#10;            int affectedRows = ps.executeUpdate();&#13;&#10;&#13;&#10;            if (affectedRows &gt; 0) {&#13;&#10;                // Récupérer l'ID généré&#13;&#10;                try (ResultSet generatedKeys = ps.getGeneratedKeys()) {&#13;&#10;                    if (generatedKeys.next()) {&#13;&#10;                        hotelier.setIdHotelier(generatedKeys.getInt(1));&#13;&#10;                    }&#13;&#10;                }&#13;&#10;                System.out.println(&quot;Inscription hotelier réussie - ID: &quot; + hotelier.getIdHotelier());&#13;&#10;                return true;&#13;&#10;            }&#13;&#10;        } catch (SQLException e) {&#13;&#10;            System.err.println(&quot;Erreur inscription hotelier : &quot; + e.getMessage());&#13;&#10;            e.printStackTrace();&#13;&#10;        }&#13;&#10;        return false;&#13;&#10;    }&#13;&#10;&#13;&#10;    // Mettre à jour le statut de vérification&#13;&#10;    public boolean updateStatutVerification(int idHotelier, String statut) {&#13;&#10;        String sql = &quot;UPDATE hoteliers SET statut_verification = ? WHERE id_hotelier = ?&quot;;&#13;&#10;        try (Connection c = DBConnection.getConnection();&#13;&#10;             PreparedStatement ps = c.prepareStatement(sql)) {&#13;&#10;&#13;&#10;            ps.setString(1, statut);&#13;&#10;            ps.setInt(2, idHotelier);&#13;&#10;&#13;&#10;            int affectedRows = ps.executeUpdate();&#13;&#10;            if (affectedRows &gt; 0) {&#13;&#10;                System.out.println(&quot;Statut de vérification mis à jour pour l'hotelier ID: &quot; + idHotelier);&#13;&#10;                return true;&#13;&#10;            }&#13;&#10;        } catch (SQLException e) {&#13;&#10;            System.err.println(&quot;Erreur mise à jour statut vérification : &quot; + e.getMessage());&#13;&#10;            e.printStackTrace();&#13;&#10;        }&#13;&#10;        return false;&#13;&#10;    }&#13;&#10;&#13;&#10;    // Vérifier si un email existe déjà&#13;&#10;    public boolean existsByEmail(String email) {&#13;&#10;        return findByEmail(email) != null;&#13;&#10;    }&#13;&#10;&#13;&#10;    // Vérifier si un ICE existe déjà&#13;&#10;    public boolean existsByIce(String ice) {&#13;&#10;        return findByIce(ice) != null;&#13;&#10;    }&#13;&#10;&#13;&#10;    // Lister les hoteliers en attente de validation&#13;&#10;    public java.util.List&lt;Hotelier&gt; findAllEnAttente() {&#13;&#10;        String sql = &quot;SELECT * FROM hoteliers WHERE statut_verification = 'en_attente'&quot;;&#13;&#10;        java.util.List&lt;Hotelier&gt; result = new java.util.ArrayList&lt;&gt;();&#13;&#10;        try (Connection c = DBConnection.getConnection();&#13;&#10;             PreparedStatement ps = c.prepareStatement(sql)) {&#13;&#10;&#13;&#10;            ResultSet rs = ps.executeQuery();&#13;&#10;            while (rs.next()) {&#13;&#10;                Hotelier hotelier = new Hotelier();&#13;&#10;                hotelier.setIdHotelier(rs.getInt(&quot;id_hotelier&quot;));&#13;&#10;                hotelier.setNomEtablissement(rs.getString(&quot;nom_etablissement&quot;));&#13;&#10;                hotelier.setNomGerant(rs.getString(&quot;nom_gerant&quot;));&#13;&#10;                hotelier.setPrenomGerant(rs.getString(&quot;prenom_gerant&quot;));&#13;&#10;                hotelier.setVille(rs.getString(&quot;ville&quot;));&#13;&#10;                hotelier.setEmailGerant(rs.getString(&quot;email_gerant&quot;));&#13;&#10;                hotelier.setTelephone(rs.getString(&quot;telephone&quot;));&#13;&#10;                hotelier.setPassword(rs.getString(&quot;password&quot;));&#13;&#10;                hotelier.setIce(rs.getString(&quot;ice&quot;));&#13;&#10;                java.sql.Timestamp ts = rs.getTimestamp(&quot;date_inscription&quot;);&#13;&#10;                if (ts != null) hotelier.setDateInscription(ts.toLocalDateTime());&#13;&#10;                hotelier.setStatutVerification(rs.getString(&quot;statut_verification&quot;));&#13;&#10;                result.add(hotelier);&#13;&#10;            }&#13;&#10;        } catch (SQLException e) {&#13;&#10;            System.err.println(&quot;Erreur lors de la récupération des hoteliers en attente: &quot; + e.getMessage());&#13;&#10;            e.printStackTrace();&#13;&#10;        }&#13;&#10;        return result;&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>